# ANTLR

## 基本概念

语言：由一系列有意义的语句组成。

语句：由词组组成。

词组：由更小的子词组和词汇符号组成。

解释器：能分析计算或执行语句的程序。

翻译器：能将一门语言的语句转换为另一门语言的语句。

解释器或翻译器需要识别出一门特定语言的所有有意义的语句、词组和子词组。

语法分析器 `parser` 和句法分析器 `syntax analyzer`：识别语言的程序。`parser` 会建造语法分析树或句法树，记录语法分析器识别出输入语句结构的过程，以及该结构的各组成部分。

语法分析树：内部节点是词组名，用于识别子节点，将子节点归类。根节点是最抽象的一个名字。叶子节点永远是输入的词法符号。句子是符号的线性组合，本质是语法分析树在人脑中的串行化。首先生成语法分析树，再多次访问节点更高效。

句法：约束语言中各个组成部分间关系的规则。

语法：一系列规则的集合，每条规则表述出一种词汇结构。

词法分析器 `lexer`：将输入文本转换为词法符号，将相关符号分类，如 `INT`、`FLOAT`等。词法符号包含符号类型和符号对应的文本。

语法分析的两个阶段：词法分析，识别出符号。语法分析，构建语法分析树。总结：`lexer` 解析输入字符流得到词法符号给 `paser` 构建语法分析树。

根节点包含了使用规则识别词组过程中的全部信息，被称为上下文对象。每个上下文对象都知道自己识别出的词组中，开始和结束位置处的词法符号，同时提供访问该词组全部元素的途径。

## 遍历语法树

`ParseTreeListener`：将遍历树时触发的事件转化为监听器的调用。`ANTLR ` 为每个语法文件生成 `ParseTreeListener` 子类，每条规则都有对应的 `enter` 和 `exit`。

`ParseTreeVisitor`：控制遍历语法分析树的过程，通过显式方法调用访问子节点。语法的每条规则对应一个 `visit` 方法。

## 生成的文件

`Parser.java`：定义语法分析器，识别语法。

`Lexer.java`：定义词法分析器，识别词法规则。

`.tokens`：给每个定义的词法符号指定一个数字形式的类型存储在该文件。

`Listener.java`、`BaseListener.java`：`parser` 将输入文本转换成语法分析树，遍历树时触发事件回调通知 `listener`。给出回调方法定义，实现自定义功能。`BaseListener` 是默认实现。指定 `-visitor` 会生成 `Visitor` 对象。

## 规则

`parser` 规则以小写字母开头，`lexer` 规则以大写字母开头。`|` 分隔同一语言规则的若干备选分支，用圆括号把一些符号组合成子规则。

左递归规则：在某个备选分支起始位置调用自身。

监听器机制：被遍历器对象自动调用。访问器机制：必须显式调用 `visit` 访问子节点。





