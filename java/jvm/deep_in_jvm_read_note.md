# 内存区域划分

## 程序计数器

一块较小的内存空间，是当前线程执行的字节码的行号指示器。字节码解释器通过改变计数器的值选取下一条需要执行的字节码指令。每个线程都有一个独立的程序计数器。

如果线程执行的是 `Java` 方法，计数器记录的是正在执行的虚拟机字节码指令的地址；如果线程执行的是 `Native`
方法，计数器值应为空。该区域是唯一没有规定 `OutOfMemoryError` 情况的区域。

## 虚拟机栈

线程私有，生命周期和线程相同。描述的是 `Java`
方法执行的线程内存模型，每个方法被执行，虚拟机会创建一个栈帧，存储局部变量表、操作数栈、动态连接、方法出口等。每个方法被调用到执行完毕，对应一个栈帧从入栈到出栈的过程。

局部变量表存放了编译期可知的基本数据类型、对象引用，64位的 `long` 和 `double` 会占用两个 `slot`
，其余只占一个。局部变量表所需的内存空间在编译期完成分配，进入方法时，该方法需要在栈帧中分配的空间时完全确定的。

如果线程请求栈深度大于虚拟机允许的深度，抛出 `StackOverflowError`
；如果虚拟机容量可动态扩展，当栈扩展时无法申请到足够内存会抛出 `OutOfMemoryError`。

## 本地方法栈

和虚拟机栈的区别是，本地方法栈为 `Native` 方法服务。

## 堆

堆是虚拟机管理的最大的一块内存，是所有线程共享的内存区域，虚拟机启动时创建。唯一目的就是存放对象实例，是垃圾收集器管理的内存区域。
